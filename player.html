`<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Content-Security-Policy"
      content="upgrade-insecure-requests"
    />
    <title>SoccerUpdate - Select Player</title>
    <link
      rel="shortcut icon"
      href="/images/Icons8-Windows-8-Sports-Football-2.ico"
      type="image/x-icon"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
    />
    <link rel="stylesheet" href="style.css" />
    <style>
      .titlesquad {
        height: 3px;
        background-color: #a2aaad;
        margin-top: 3px;
        left: 0;
        right: 0;
        text-align: center;
        font-family: audiowide;
      }
      .wh-100px {
        width: 100px;
        height: 100px;
      }
      .kartu-pemain {
        width: 100%;
      }
      @media (min-width: 576px) {
        .kartu-pemain {
          width: 200px;
        }
      }
    </style>
  </head>

  <body>
    <h3 id="nama-klub" class="p-2 blue text-light font-lob">Loading...</h3>
    <div class="container-fluid">
      <div id="spinner-pemain" class="d-flex justify-content-center mt-2">
        <div class="spinner-border" role="status">
          <span class="sr-only">Loading...</span>
        </div>
      </div>
      <div id="app"></div>
    </div>
  </body>

  <!-- JQuery full -->
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
    integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  ></script>
  <!-- Bootstrap -->
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns"
    crossorigin="anonymous"
  ></script>
  <!-- Axios -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <template id="kartu-posisi">
    <div>
      <div id="judul-posisi" class="h4 mt-4 text-center font-lob">Squad</div>
      <div class="titlesquad"></div>
      <div class="p-2">
        <div class="card">
          <div id="pemain" class="d-flex flex-wrap p-2"></div>
        </div>
      </div>
    </div>
  </template>

  <script>
    const urlparams = new URLSearchParams(window.location.search);
    const klubId = urlparams.get("id");
    const klubNama = urlparams.get("klubNama");
    const kompId = urlparams.get("kompId");
    const kompNama = urlparams.get("kompNama");
    const spinnerPemain = document.getElementById("spinner-pemain");
    const templateKartuPosisi = document.getElementById("kartu-posisi");

    const TOKENFD = "2a387b1f03a64802beb320a10941fd47";
    const PLACEHOLDERIMG =
      "https://www.fcbarcelona.com/photo-resources/2020/02/28/504c822c-5fa1-44d5-8252-cdec93a519d8/Braithwaite-app.png?width=670&height=790";

    const getPlayer = async (id) => {
      const url = `https://api.football-data.org/v2/teams/${id}`;
      const response = await axios
        .get(url, {
          headers: {
            "X-Auth-Token": TOKENFD,
          },
        })
        .then((res) => {
          let clubName = res.data.name;
          $("#nama-klub").html("Squad : " + clubName);
          let objGroupByPos = {};
          let teamSquad = res.data.squad;
          let crestUrl = res.data.crestUrl;
          teamSquad.forEach((person) => {
            let position =
              person.role === "PLAYER" ? person.position : person.role;
            !objGroupByPos[position] && (objGroupByPos[position] = []);
            objGroupByPos[position].push(person);
          });
          for (const position in objGroupByPos) {
            let kartu =
              templateKartuPosisi.content.firstElementChild.cloneNode(true);
            kartu.querySelector("#judul-posisi").innerHTML = position;
            let htmlContent = "";
            objGroupByPos[position].forEach((person) => {
              htmlContent += `<div class="card d-flex flex-wrap pt-3 px-3 m-2 kartu-pemain">
                        <a href="player_detail.html?id=${person.id}&orgNama=${person.name}&klubId=${id}&klubNama=${name}&klubImg=${crestUrl}&kompId=${kompId}&kompNama=${kompNama}" class="d-flex align-items-center flex-column">
                            <img src="${PLACEHOLDERIMG}" class="card-img-top wh-100px">
                            <div class="card-body">
                                <p class="card-title text-center">${person.name}</p>
                                <div class="blue mt-2">
                                    <p class="text-light m-2 p-2 text-center">${person.nationality}</p>
                                </div>
                            </div>
                        </a>
                    </div>`;
            });
            kartu.querySelector("#pemain").innerHTML = htmlContent;
            $("#app").append(kartu);
            spinnerPemain.classList.replace("d-flex", "d-none");
          }
        });
    };
    getPlayer(klubId);
  </script>
</html>
